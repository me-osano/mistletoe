#!/bin/bash

set -e

# Ensure screensaver/sleep doesn't set in during updates
hyprctl dispatch tagwindow +noidle &> /dev/null || true

# Capture update logs
exec > >(tee "/tmp/mistletoe-update.log") 2>&1

# Perform all update steps
mistletoe-update-time
mistletoe-update-keyring
mistletoe-update-available-reset
mistletoe-update-system-pkgs
mistletoe-migrate
mistletoe-update-aur-pkgs
mistletoe-update-orphan-pkgs
mistletoe-hook post-update

mistletoe-update-analyze-logs

mistletoe-update-restart

# Re-enable screensaver/sleep after updates
hyprctl dispatch tagwindow -- -noidle &> /dev/null || true
